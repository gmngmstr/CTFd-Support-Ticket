{% extends "base.html" %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ url_for('views.themes', path='css/challenge-board.css') }}">
{% endblock %}

{% block content %}
	<div class="jumbotron">
		<div class="container">
			<h1>Support Tickets
				{% if "User" in access %}
					<a class="no-decoration" href="{{ url_for('new_ticket') }}">
					<span role="button" data-toggle="tooltip" title="Create Ticket">
						<i class="btn-fa fas fa-plus-circle"></i>
					</span>
					</a>
				{% endif %}
			</h1>
		</div>
	</div>

	{% if infos %}
		<div class="container">
			<div id='errors' class="row">
				<div class="col-md-12">
					{% for info in infos %}
						<h1 class="text-center">{{ info }}</h1>
					{% endfor %}
				</div>
			</div>
		</div>
	{% endif %}

	{% if errors %}
		<div class="container">
			<div id='errors' class="row">
				<div class="col-md-12">
		{% for error in errors %}
					<h1 class="text-center">{{ error }}</h1>
		{% endfor %}
				</div>
			</div>
		</div>
	{% endif %}

	{% if admin or not errors %}
		<div class="container">
			<div id='ticket-board'>
				<form id="Pending-board" style="display:none" method="GET" action="/support_ticket/view">
					<div class="category-header col-md-12 mb-3">
						<h3>Pending</h3>
					</div>
					<div id="Pending-tickets" class="category-challenges col-md-12">
					</div>
				</form>
				<form id="Open-board" style="display:none" method="GET" action="/support_ticket/view">
					<div class="category-header col-md-12 mb-3">
						<h3>Open</h3>
					</div>
					<div id="Open-tickets" class="category-challenges col-md-12">
					</div>
				</form>
				<form id="Closed-board" style="display:none" method="GET" action="/support_ticket/view">
					<div class="category-header col-md-12 mb-3">
						<h3>Closed</h3>
					</div>
					<div id="Closed-tickets" class="category-challenges col-md-12">
					</div>
				</form>
			</div>
		</div>

		<input id="nonce" type="hidden" name="nonce" value="{{ nonce }}">
	{% endif %}
{% endblock %}

{% block scripts %}
	<script type="text/javascript">
		setTimeout("location.reload(true);", 60000);
		var access = "{{ access }}";
		var ticket_list = {
			"Pending":{
				{% for ticket in ticket_list %}
					{% if "Pending" == ticket.state %}
						{{ ticket.id }}:{"category":"{{ ticket.challenge_cat }}", "name":"{{ ticket.challenge_name }}"{% if "Admin" in access %}, "user":"{{ ticket.creator }}"{% endif %} },
					{% endif %}
				{% endfor %}
			}, "Open":{
				{% for ticket in ticket_list %}
					{% if "Open" == ticket.state %}
						{{ ticket.id }}:{"category":"{{ ticket.challenge_cat }}", "name":"{{ ticket.challenge_name }}"{% if "Admin" in access %}, "user":"{{ ticket.creator }}"{% endif %} },
					{% endif %}
				{% endfor %}
			}, "Closed":{
				{% for ticket in ticket_list %}
					{% if "Closed" == ticket.state %}
						{{ ticket.id }}:{"category":"{{ ticket.challenge_cat }}", "name":"{{ ticket.challenge_name }}"{% if "Admin" in access %}, "user":"{{ ticket.creator }}"{% endif %} },
					{% endif %}
				{% endfor %}
			}
		};
	</script>
	<script src="{{ request.script_root }}/support_ticket/static/support_tickets.js"></script>
{% endblock %}
